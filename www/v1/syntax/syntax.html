<!DOCTYPE html>
<html>
<head>
  <title>Egg Syntax</title>
  <style>
    body {
      margin: 0 24px;
      counter-reset: h2
    }
    pre {
      display: table;
      background-color: hsl(30,80%,96%);
      border: 1px solid hsl(30,80%,75%);
      margin: 1em 0;
      padding: 1ex 2ex;
    }
    code {
      background-color: hsl(30,80%,93%);
      padding: 0 0.5ex;
    }
    h2 {
      counter-reset: h3
    }
    h3 {
      counter-reset: h4
    }
    h4 {
      counter-reset: h5
    }
    h2:before {
      counter-increment: h2;
      content: counter(h2) ". "
    }
    h3:before {
      counter-increment: h3;
      content: counter(h2) "." counter(h3) ". "
    }
    h4:before {
      counter-increment: h4;
      content: counter(h2) "." counter(h3) "." counter(h4) ". "
    }
    h5:before {
      counter-increment: h5;
      content: counter(h2) "." counter(h3) "." counter(h4) "." counter(h5) ". "
    }
    h6 {
      font-weight: normal;
    }
    h1, h2, h3, h4, h5, h6 {
      border: 1px solid hsl(30,80%,25%);
      border-radius: 1ex;
      margin: 16px -16px;
      padding: 0.5ex 1ex;
      background-color: #FED;
      box-shadow: 3px 3px 2px hsla(30,80%,25%,25%);
    }
    .railroad, .diagram {
      margin-top: 0.5em;
      padding-top: 0.25em;
      filter: drop-shadow(3px 3px 2px hsl(30,80%,25%,25%));
    }
    #ascii {
      font-weight: bold;
      border: 1px solid hsl(30,80%,25%);
      margin: 1em 0 0 0;
    }
    #ascii .rule {
      background-color: rgba(0,0,255,0.1);
      color: rgb(0,0,255);
      border-radius: 1em;
      line-height: 150%;
    }
    #ascii .token {
      background-color: rgba(0,255,0,0.2);
      color: rgb(0,128,0);
      border-radius: 0.3em;
      line-height: 150%;
    }
    #ascii .terminal {
      background-color: rgba(255,0,0,0.2);
      color: rgb(128,0,0);
      line-height: 150%;
    }
    #ascii pre {
      margin: 0;
      border: none;
    }
    .code {
      margin-left: 22px;
      border-radius: 1ex;
      box-shadow: 3px 3px 2px hsla(30,80%,25%,25%);
    }
    .code-comment {
      color: hsl(132,80%,33%);
    }
    .code-string {
      color: hsl(235,80%,33%);
    }
    .code-identifier {
      color: hsl(30,80%,33%);
    }
    .code-keyword {
      color: hsl(287,80%,33%);
      font-weight: bold;
    }
  </style>
  <script lang="JavaScript" src="syntax.js" type="text/javascript"></script>
  <script lang="JavaScript" src="bnf.js" type="text/javascript"></script>
</head>
<body>
  <h1>The Egg Programming Language Syntax</h1>
  This document contains details of the syntax of the egg programming language.
  It is not designed as a resource for learning the language from scratch, but programmers fluent in other computer languages may find it useful as an overview of egg.
  <h2>Informal Syntax</h2>
  This section gives an informal overview of the syntax.
  <h3>Egg Railroad Diagrams</h3>
  A <a href="https://en.wikipedia.org/wiki/Syntax_diagram">railroad diagram</a> is a visual representation of a syntax specification.
  Egg uses a particular style of railroad diagram which we describe here.
  Each rule is enclosed in a cyan box with the rule name on a tab in the top-left.
  A green track flows into the rule from the left, passes through the rule box and exits to the right.
  In the example below, the rule "<i>greeting</i>" is defined simply as the token "<code>hello</code>", represented by a purple box:
  <div class="diagram">{ "greeting": {"token": "hello", "inline": false, "left": 1, "right": 1} }</div>
  Note that tokens are indivisible and case-sensitive.
  The above rule would match the text "<code>hello</code>" but not "<code>hell o</code>" or "<code>Hello</code>".
  We can change the rule to accept a <i>sequence</i> of tokens, optionally separated by whitespace (including newlines):
  <div class="diagram">{ "greeting": {"sequence": [{"token": "hello"}, {"token": "world"}], "inline": false, "left": 1, "right": 1} }</div>
  We can also introduce <i>choices</i> by putting junctions in the tracks.
  The following rule accepts either "<code>hello</code>" or "<code>hi</code>"; but exactly one of them must be specified:
  <div class="diagram">{ "greeting": {"choice": [{"token": "hello"}, {"token": "hi"}], "inline": false} }</div>
  In the following rule, "<code>hello</code>" is compulsory, but "<code>world</code>" is <i>optional</i> (however, it must follow "<code>hello</code>"):
  <div class="diagram">{ "greeting": {"sequence": [{"token": "hello"}, {"zeroOrOne": {"token": "world"}}], "inline": false, "left": 1} }</div>
  We can introduce <i>repetition</i> by making the tracks loops back on the themselves.
  The following rule matches "<code>world</code>" followed by one or more question marks:
  <div class="diagram">{ "greeting": {"sequence": [{"token": "hello"}, {"oneOrMore": {"token": "?"}}], "inline": false, "left": 1, "right": 1} }</div>
  By comparison, this rule matches "<code>world</code>" followed by zero or more question marks:
  <div class="diagram">{ "greeting": {"sequence": [{"token": "hello"}, {"zeroOrMore": {"token": "?"}}], "inline": false, "left": 1, "right": 1} }</div>
  Sometimes, the items in the rule are not tokens, but some other kind of <i>terminal</i>, described informally elsewhere.
  In this case, the terminal is drawn in a blue hexagon:
  <div class="diagram">{ "name": {"oneOrMore": {"terminal": "letter"}, "inline": false, "left": 1, "right": 1} }</div>
  Finally, rules can be composed by referring to them within other rules using brown ovals:
  <div class="diagram">{ "greeting-personal": {"sequence": [{"rule": "greeting"}, {"rule": "name"}], "inline": false, "left": 1, "right": 1} }</div>
  <h3>Egg Syntax</h3>
  Egg programs are split up into distinct parts, named "modules".
  The source code for each module is typically stored in a separate text file.
  <h4>Comments</h4>
  Comments in egg source files can either be a single line or multiple lines:
  <div class="diagram">{ "comment": {"choice": [{"sequence": [{"token": "//"}, {"zeroOrMore": {"terminal": "any character except newline"} }, {"terminal": "newline"}]}, {"sequence": [{"token": "/*"}, {"zeroOrMore": {"terminal": "any character"}}, {"token": "*/"}]}] } }</div>
  For example:
  <pre class="code">// This is a comment until the end of the line

/* This is a comment
    that's split over
     multiple lines */</pre>
  Comments can appear anywhere where whitespace is acceptable.
  <h4>Modules</h4>
  Modules contain one or more statements.
  Each statement may be preceded one or more attributes.
  <div class="railroad">module</div>
  <h4>Statements</h4>
  A statement is one of the following:
  <ul>
    <li>a compound statement consisting of zero or more statements within a pair of curly braces,</li>
    <li>a simple statement with a trailing semicolon,</li>
    <li>a function definition, or</li>
    <li>a flow control statement.</li>
  </ul>
  <div class="railroad">statement</div>
  A simple statement is an action, a type definition or a variable definition:
  <div class="railroad">statement-simple</div>
  An action is an assignment, an increment/decrement or a function call statement:
  <div class="railroad">statement-action</div>
  Assignments can simply store a value in a target, such as:
  <pre class="code">target = value;</pre>
  or they may incorporate a binary operator to modify the target:
  <pre class="code">target += value;</pre>
  The latter is equivalent to the following (except that the target expression is evaluated only once):
  <pre class="code">target = target + value;</pre>
  See below for details of binary operators.
  In egg, increments and decrements are statements (not expressions) and must use the prefix unary operators:
  <pre class="code">++target;
--target;</pre>
  The statements above are analogous to:
  <pre class="code">target = target + 1;
target = target - 1;</pre>
  They are included in the language so that classic index-based for-loop idioms can be used:
  <pre class="code">for (i = 0; i < 100; ++i) {
  // Loops from 0 to 99 inclusive
}</pre>
  <h4>Flow Control</h4>
  <h5>If Statement</h5>
  Like most computer languages, <code>if</code> statements can have optional <code>else</code> clauses:
  <div class="railroad">statement-if</div>
  Note that the curly braces are compulsory, <i>except</i> when an <code>else</code> clause is immediately followed by another <code>if</code> statement:
  <pre class="code">if (condition1) {
  // Do this only if 'condition1' is true
}

if (condition2) {
  // Do this only if 'condition2' is true
} else {
  // Do this only if 'condition2' is false
}

if (condition3) {
  // Do this only if 'condition3' is true
} else if (condition4) {
  // Do this only if 'condition3' is false but 'condition4' is true
} else {
  // Do this if both 'condition3' and 'condition4' are false
}</pre>
  <h5>Switch Statement</h5>
  The <code>switch</code> statement acts like a series of <code>if</code> statements:
  <div class="railroad">statement-switch</div>
  Unlike some other programming languages, expressions in the <code>case</code> statements need not be constant.
  Each <code>case</code>/<code>default</code> clause must end in a <code>break</code>, <code>continue</code>, <code>return</code> or <code>throw</code> statement.
  A <code>break</code> statement breaks out of the <code>switch</code> statement.
  A <code>continue</code> statement continues execution at the beginning of the next (or first) <code>case</code>/<code>default</code> clause.
  For example:
  <pre class="code">switch (greeting) {
  case "hello":
  case "hi":
    english = true;
    continue;
  case greetingInLocalLanguage():
    print("greeting is ", greeting, "\n");
    break;
  default:
    throw "unknown greeting";
}</pre>
  <h5>While Loop</h5>
  The <code>while</code> loop executes the statements within its curly brace block whilst a condition is true:
  <div class="railroad">statement-while</div>
  For example:
  <pre class="code">// Find the factorial of n
var factorial = 1;
while (n > 1) {
  factorial *= n;
  --n;
}</pre>
  You can break out of the loop with a <code>break</code> statement or go to the next iteration with <code>continue</code>.
  <h5>Do Loop</h5>
  The similar <code>do</code> loop executes the statements at least once:
  <div class="railroad">statement-do</div>
  For example:
  <pre class="code">// Print 10 to 1 in descending order
var i = 10;
do {
  print(i, "\n");
  --i;
} while (i > 0);</pre>
  You can break out of the loop with a <code>break</code> statement or go to the next iteration with <code>continue</code>.
  <h5>For Loop</h5>
  The <code>for</code> loop comes in two flavours.
  The vanilla <code>for</code> loop takes an <i>initialization</i> statement, a <i>condition</i>, an <i>advance</i> statement and a block of statements within curly braces.
  <div class="railroad">statement-for</div>
  For example:
  <pre class="code">// Sum the integers up to and including 'n'
var sum = 0;
for (var i = 1; i <= n; ++i) {
  sum += i;
}</pre>
  The second flavour of the <code>for</code> loop is "foreach".
  It loops over all the elements in an expression.
  <div class="railroad">statement-foreach</div>
  For example:
  <pre class="code">// Sum the elements of an array
var array = [1, 2, 3, 5, 8, 13, 21];
var sum = 0;
for (var i : array) {
  sum += i;
}</pre>
  In both flavours of <code>for</code>, you can break out of the loop with a <code>break</code> statement or go to the next iteration with <code>continue</code>.
  <h5>Break Statement</h5>
  A <code>break</code> statement prematurely breaks out of a <code>while</code>, <code>do</code> or <code>for</code> loop.
  <div class="railroad">statement-break</div>
  For example:
  <pre class="code">// Sum the elements until the total is greater than twenty
var array = [1, 2, 3, 5, 8, 13, 21];
var sum = 0;
for (var i : array) {
  sum += i;
  if (sum > 20) {
    break;
  }
}</pre>
  It is also used to break out from a <code>switch</code> statement.
  <h5>Continue Statement</h5>
  A <code>continue</code> statement immediately starts the next iteration of a <code>while</code>, <code>do</code> or <code>for</code> loop.
  <div class="railroad">statement-continue</div>
  It can also be used in a <code>switch</code> statement to continue execution at the beginning of the next (or first) <code>case</code>/<code>default</code> clause.
  <h5>Throw Statement</h5>
  A <code>throw</code> statement raises an exception.
  <div class="railroad">statement-throw</div>
  Execution continues at the most recent, active <code>catch</code> clause that matches the type of the expression:
  For example:
  <pre class="code">float safeSqrt(double x) {
  if (x < 0) {
    throw "attempt to take the square root of a negative number";
  }
  return math.sqrt(x);
}

float y;
try {
  y = safeSqrt(-1);
} catch (any exception) {
  print("exception thrown: ", exception);
  // Handle the problem here
}</pre>
  Within a <code>catch</code> clause, a <code>throw</code> statement without an expression re-throws the original exception:
  <pre class="code">try {
  y = safeSqrt(-1);
} catch (any exception) {
  print("exception thrown: ", exception);
  throw; // Rethrow the exception
}</pre>
  <h5>Try Statement</h5>
  The <code>try</code> statement comes in two flavours.
  A <code>try</code> statement without a <code>finally</code> clause must have at least one <code>catch</code> clause:
  <div class="railroad">statement-try</div>
  The first <code>catch</code> clause, if any, that matches the type of the exception thrown within the <code>try</code> block, is executed.
  <div class="railroad">statement-catch</div>
  For example:
  <pre class="code">try {
  runSomethingThatMightFail();
} catch (ArithmeticException exception) {
  reportProblem("arithmetic", exception);
} catch (any exception) {
  reportProblem("something else", exception);
}</pre>
  In <code>try</code> statements with a <code>finally</code> clause, <code>catch</code> clauses are optional:
  <div class="railroad">statement-try-finally</div>
  The <code>finally</code> clause is always executed, whether or not an exception is thrown or caught.
  <pre class="code">var resource = acquireResource();
try {
  processResource(resource);
} finally {
  releaseResource(resource);
}</pre>
  <h5>Return Statement</h5>
  For functions defined to a return value, the <code>return</code> statement exits the function and return the expression to the caller:
  <div class="railroad">statement-return</div>
  <h4>And...</h4>
  <div class="railroad">statement-yield</div>
  <div class="railroad">definition-type</div>
  <div class="railroad">definition-variable</div>
  <div class="railroad">definition-function</div>
  <div class="railroad">definition-function-parameter</div>
  <div class="railroad">type-expression</div>
  <div class="railroad">type-expression-primary</div>
  <div class="railroad">expression</div>
  <div class="railroad">expression-binary</div>
  <div class="railroad">expression-unary</div>
  <div class="railroad">expression-primary</div>
  <div class="railroad">expression-function</div>
  <div class="railroad">expression-lambda</div>
  <div class="railroad">condition</div>
  <div class="railroad">assignment-target</div>
  <div class="railroad">parameter-list</div>
  <div class="railroad">identifier</div>
  <div class="railroad">literal</div>
  <div class="railroad">literal-int</div>
  <div class="railroad">literal-float</div>
  <div class="railroad">literal-string</div>
  <div class="railroad">literal-object</div>
  <div class="railroad">literal-array</div>

  <h2>TODO</h2>
  <h3>Attributes</h3>
  <div class="railroad">attribute</div>
  <div class="railroad">statement-call</div>

  <h2>Formal Syntax</h2>
  <h3>EBNF</h3>
  <details>
    <summary>Show syntax in <a href="https://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_form">extended Backus-Naur form</a></summary>
    <div id="ascii"></div>
  </details>
  <h3>Railroad</h3>
  <details>
    <summary>Show syntax in <a href="http://www.bottlecaps.de/rr/ui">Railroad Diagram Generator</a> format</summary>
    <pre id="bottlecaps"></pre>
  </details>
  <h6>Copyright &copy; 2018-<span id="year">2019</span> <a href="http://chilliant.com">chilliant.com</a></h6>
  <script lang="JavaScript" type="text/javascript">
    egg.year("year");
    egg.diagram(document.getElementsByClassName("diagram"));
    egg.railroad(document.getElementsByClassName("railroad"));
    egg.prettify(document.getElementsByClassName("code"));
    egg.syntax("ascii");
    egg.syntax("bottlecaps");
  </script>
</body>
</html>
